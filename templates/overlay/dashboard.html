<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikBot - ë°©ì†¡ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="/static/css/overlay.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 20px;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
        }
        
        .dashboard-section {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #00d4ff;
        }
        
        .section-title {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body class="overlay-body">
    <div class="dashboard-grid">
        <!-- ì‹¤ì‹œê°„ ì±„íŒ… -->
        <div class="dashboard-section">
            <div class="section-title">ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</div>
            <div id="chat-messages" class="chat-messages" style="height: 300px; overflow-y: auto;">
                <!-- ì±„íŒ… ë©”ì‹œì§€ë“¤ -->
            </div>
        </div>
        
        <!-- í†µê³„ -->
        <div class="dashboard-section">
            <div class="section-title">ğŸ“Š ë°©ì†¡ í†µê³„</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-icon">ğŸ’¬</div>
                    <div class="stat-value" id="messages-count">0</div>
                    <div class="stat-label">ë©”ì‹œì§€</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-value" id="followers-count">0</div>
                    <div class="stat-label">íŒ”ë¡œì›Œ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ğŸ</div>
                    <div class="stat-value" id="gifts-count">0</div>
                    <div class="stat-label">ì„ ë¬¼</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-value" id="uptime">00:00:00</div>
                    <div class="stat-label">ë°©ì†¡ì‹œê°„</div>
                </div>
            </div>
        </div>
        
        <!-- ëª©í‘œ ì¶”ì  -->
        <div class="dashboard-section">
            <div class="section-title">ğŸ¯ ëª©í‘œ ë‹¬ì„±</div>
            <div id="goal-section">
                <div class="goal-info">
                    <div class="goal-title" id="goal-title">ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”!</div>
                    <div class="goal-description" id="goal-description">ë°©ì†¡ ëª©í‘œë¥¼ ë‹¬ì„±í•´ ë‚˜ê°€ì„¸ìš”.</div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span id="current-value">0</span> / <span id="target-value">100</span>
                        (<span id="progress-percent">0</span>%)
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ìµœê·¼ ì•Œë¦¼ -->
        <div class="dashboard-section">
            <div class="section-title">ğŸ”” ìµœê·¼ ì•Œë¦¼</div>
            <div id="recent-alerts" style="height: 300px; overflow-y: auto;">
                <!-- ìµœê·¼ ì•Œë¦¼ë“¤ -->
            </div>
        </div>
    </div>
    
    <script src="/static/js/overlay-websocket.js"></script>
    <script>
        const dashboard = new OverlayWebSocket('{{ websocket_url }}');
        
        // ì±„íŒ… ë©”ì‹œì§€ ì²˜ë¦¬
        dashboard.on('new_comment', function(data) {
            addChatMessage(data);
        });
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        dashboard.on('stats_update', function(data) {
            updateStats(data);
        });
        
        // ëª©í‘œ ì—…ë°ì´íŠ¸
        dashboard.on('goal_update', function(data) {
            updateGoal(data);
        });
        
        // ìƒˆ íŒ”ë¡œìš° ì•Œë¦¼
        dashboard.on('new_follow', function(data) {
            addAlert('follow', `ğŸ‰ ${data.nickname}ë‹˜ì´ íŒ”ë¡œìš°í–ˆìŠµë‹ˆë‹¤!`);
        });
        
        // ì„ ë¬¼ ì•Œë¦¼
        dashboard.on('new_gift', function(data) {
            const message = `ğŸ ${data.nickname}ë‹˜ì´ ${data.gift_name} ${data.gift_count}ê°œë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤!`;
            addAlert('gift', message);
        });
        
        function addChatMessage(data) {
            const container = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            const timestamp = new Date(data.timestamp).toLocaleTimeString();
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="username">${escapeHtml(data.nickname || data.username)}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="message-content">${escapeHtml(data.comment)}</div>
            `;
            
            container.appendChild(messageDiv);
            
            // ë©”ì‹œì§€ ìˆ˜ ì œí•œ
            const messages = container.querySelectorAll('.chat-message');
            if (messages.length > 20) {
                messages[0].remove();
            }
            
            container.scrollTop = container.scrollHeight;
        }
        
        function updateStats(stats) {
            document.getElementById('messages-count').textContent = stats.messages_received || 0;
            document.getElementById('followers-count').textContent = stats.followers_gained || 0;
            document.getElementById('gifts-count').textContent = stats.gifts_received || 0;
            
            if (stats.uptime) {
                document.getElementById('uptime').textContent = stats.uptime;
            }
        }
        
        function updateGoal(goal) {
            if (!goal || !goal.active) return;
            
            document.getElementById('goal-title').textContent = goal.title || 'ëª©í‘œ';
            document.getElementById('goal-description').textContent = goal.description || '';
            
            const current = goal.current || 0;
            const target = goal.target || 100;
            const percent = Math.min(100, Math.round((current / target) * 100));
            
            document.getElementById('current-value').textContent = current;
            document.getElementById('target-value').textContent = target;
            document.getElementById('progress-percent').textContent = percent;
            document.getElementById('progress-fill').style.width = percent + '%';
        }
        
        function addAlert(type, message) {
            const container = document.getElementById('recent-alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `recent-alert alert-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            alertDiv.innerHTML = `
                <div class="alert-content">${message}</div>
                <div class="alert-time">${timestamp}</div>
            `;
            
            container.insertBefore(alertDiv, container.firstChild);
            
            // ì•Œë¦¼ ìˆ˜ ì œí•œ
            const alerts = container.querySelectorAll('.recent-alert');
            if (alerts.length > 10) {
                alerts[alerts.length - 1].remove();
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>