<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikBot - 채팅 오버레이</title>
    <link rel="stylesheet" href="/static/css/overlay.css">
</head>
<body class="overlay-body">
    <div id="chat-container" class="chat-container">
        <h3 class="overlay-title">💬 실시간 채팅</h3>
        <div id="chat-messages" class="chat-messages">
            <!-- 채팅 메시지들이 여기에 표시됩니다 -->
        </div>
    </div>
    
    <script src="/static/js/overlay-websocket.js"></script>
    <script>
        const chatOverlay = new OverlayWebSocket('{{ websocket_url }}');
        
        chatOverlay.on('new_comment', function(data) {
            addChatMessage(data);
        });
        
        function addChatMessage(data) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            const timestamp = new Date(data.timestamp).toLocaleTimeString();
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="username">${escapeHtml(data.nickname || data.username)}</span>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div class="message-content">${escapeHtml(data.comment)}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            
            // 최대 메시지 수 제한
            const messages = messagesContainer.querySelectorAll('.chat-message');
            if (messages.length > {{ max_messages | default(20) }}) {
                messages[0].remove();
            }
            
            // 스크롤을 맨 아래로
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // 애니메이션 효과
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateX(20px)';
            setTimeout(() => {
                messageDiv.style.transition = 'all 0.3s ease';
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateX(0)';
            }, 10);
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>